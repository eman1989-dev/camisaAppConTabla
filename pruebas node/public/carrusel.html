<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carrusel de Camisetas</title>
  <style>
        /* Contenedor del carrusel */
        .contenedor-camisetas {
        display: flex;
        flex-direction: row;
        overflow-x: auto;
        scroll-snap-type: x mandatory;   /* Scroll horizontal con encaje obligatorio */
        scroll-behavior: smooth;        /* Desplazamiento suave */
        -webkit-overflow-scrolling: touch; /* Suaviza scroll en iOS */
        }
        /* Ocultar la barra de scroll (opcional) */
        .contenedor-camisetas::-webkit-scrollbar {
        display: none;
        }
        .contenedor-camisetas {
        scrollbar-width: none;        /* Firefox */
        -ms-overflow-style: none;     /* IE/Edge legacy */
        }

        /* Tarjetas del carrusel */
        .card {
        flex-shrink: 0;        /* Evita que la tarjeta se encoja más allá de su contenido */
        flex-basis: 200px;     /* Ancho base de cada tarjeta (puedes ajustarlo) */
        scroll-snap-align: start;  /* Encaja al inicio del contenedor al hacer scroll */
        margin-right: 1rem;    /* Separación entre tarjetas */
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 1rem;
        background: #fafafa;
        }
        /* Opcional: última tarjeta sin margen derecho extra */
        .card:last-child {
        margin-right: 0;
        }

        /* Estilos internos de la tarjeta */
        .shirt-preview {
        margin-bottom: 0.5rem;
        }
        .creator-name {
        font-size: 1.1rem;
        margin: 0.5rem 0 0.25rem;
        }
        .rating, .creation-date {
        font-size: 0.9rem;
        margin: 0.25rem 0;
        }
        button.like-btn, button.dislike-btn {
        margin: 0.5rem 0.5rem 0 0;
        padding: 0.4rem 0.8rem;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        }
        button.like-btn { background-color: #4caf50; color: #fff; }
        button.dislike-btn { background-color: #f44336; color: #fff; }
        button.like-btn:hover { background-color: #45a049; }
        button.dislike-btn:hover { background-color: #e53935; }
  </style>
</head>
<body>

  <!-- Contenedor del carrusel -->
  <div class="contenedor-camisetas" id="contenedor-camisetas">
    <!-- Las tarjetas se insertarán aquí dinámicamente con JS -->
  </div>

  <script>
    // app.js

    // Función para formatear fecha (ejemplo simple)
    function formatearFecha(isoDate) {
    const opciones = { year: 'numeric', month: 'numeric', day: 'numeric' };
    return new Date(isoDate).toLocaleDateString('es-ES', opciones);
    }

    // Función principal para cargar las camisetas y generar el carrusel
    // Cargar camisetas desde el backend y renderizar en el carrusel
    async function cargarCamisetas() {
    try {
    const resp = await fetch('/api/camisetas', {
    headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
    });
    const camisetas = await resp.json();

    const contenedor = document.getElementById('contenedor-camisetas');
    contenedor.innerHTML = ''; // Limpiar carrusel

    camisetas.forEach(c => {
    let nombre = 'Desconocido';
    if (c.creador && typeof c.creador === 'object') {
    nombre = c.creador.nombre || c.creador.correo || 'Usuario';
    } else if (typeof c.creador === 'string') {
    nombre = c.creador;
    }

    const calificacion = typeof c.calificacion === 'number' ? c.calificacion.toFixed(1) : '0.0';

    const card = document.createElement('div');
    card.classList.add('card');
    card.innerHTML = `
    ${generarMiniatura(c)}
    <div class="nombre-creador">${nombre}</div>
    <div class="calificacion">Calificación: ⭐ ${calificacion}</div>
    <div class="fecha">${new Date(c.fechaCreacion).toLocaleDateString()}</div>
    <div class="botones-reaccion">
    <button class="btn-like" onclick="reaccion('${c._id}', 1)">Me gusta</button>
    <button class="btn-dislike" onclick="reaccion('${c._id}', -1)">No me gusta</button>
    </div>
    `;
    contenedor.appendChild(card);
    });

    } catch (error) {
    console.error('Error al cargar camisetas:', error);
    }
    }

    // Cargar las camisetas al iniciar la página
    cargarCamisetas();

    // Función para enviar voto de calificación
    async function reaccion(id, valor) {
    try {
        const resp = await fetch(`/api/camisetas/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer '+localStorage.getItem('token')
        },
        body: JSON.stringify({ calificacion: valor })
        });
        if (!resp.ok) {
        throw new Error('Error al enviar voto');
        }
        // Se asume que el servidor devuelve la camiseta actualizada o un status 200
        console.log(`Voto enviado para camiseta ${id}: ${valor}`);
        // Volver a cargar las camisetas para actualizar la UI con la nueva calificación
        await cargarCamisetas();
    } catch (error) {
        console.error('Error votando camiseta:', error);
    }
    }

    function generarMiniatura(c) {
    return `
    <svg class="miniatura" viewBox="1 2 26 14">
    <path d="M 4 8 M 5 3 L 5 6 L 3 7 L 1 5" fill="${c.mangaIzqColor}" />
    <path d="M 9 5 L 7 3 L 5 3 L 5 6 L 5 12 L 13 12 L 13 6 L 13 3 L 11 3" fill="${c.torsoColor}" />
    <path d="M 13 6 L 13 3 L 17 5 L 15 7" fill="${c.mangaDerColor}" />
    <path d="M 8 2 L 7 3 L 9 5 L 8 3" fill="${c.cuelloIzqColor}" />
    <path d="M 10 2 L 11 3 L 9 5 L 10 3 M 1 4" fill="${c.cuelloDerColor}" />
    </svg>`;
    }

  </script>
</body>
</html>
